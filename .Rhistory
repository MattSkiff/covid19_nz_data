confirmed_cases_new_24 <- 73
probable_cases <- 21
probable_cases_new_24 <- 5
recovered_cases <- 27
recovered_cases_new_24 <- 5
community_cases <- "Unknown"
alert_level <- 4
###
# set text size on x axis
text_size = 8
zoom_level_init = 5.5
lat_init = -39.9005585
lng_init = 172.8859711
min_zoom = 3
max_zoom = 7
moh_open_link <- "window.open('https://www.health.govt.nz/our-work/diseases-and-conditions/covid-19-novel-coronavirus/covid-19-current-cases', '_blank')"
dhb.sdf <- dhb.sdf()
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = "white",
weight = 1,
opacity = 1,
color = "black",
dashArray = "3",
fillOpacity = 0.7) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~Freq, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdfvalue, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
colnames(covid_dhb.df)[1] <- "DHB2015_Na"
dhb.sdf <- dhs.sdf()
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = dhb.sdf,
by = "DHB2015_Na")
dhb.sdf@data$Freq[is.na(dhb.sdf@data$Freq)] <- 0
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
colnames(covid_dhb.df)[1] <- "DHB2015_Na"
dhb.sdf <- dhs.sdf()
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = dhb.sdf,
by = "DHB2015_Na")
dhb.sdf@data$Freq[is.na(dhb.sdf@data$Freq)] <- 0
colnames(covid_dhb.df)[1] <- "DHB2015_Na"
dhb.sdf <- dhs.sdf
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = dhb.sdf,
by = "DHB2015_Na")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = covid_dhb.df,
by = "DHB2015_Na")
dhb.sdf@data$Freq[is.na(dhb.sdf@data$Freq)] <- 0
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$REGC2020_2,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
runApp()
runApp()
runApp()
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
runApp()
runApp()
library("rgeos")
dgb_centres <- gCentroid(dhb.sdf,byid = TRUE)
dgb_centres
?addCircleMarkers
dgb_centres
dgb_centres[,1]
dgb_centres@coords
dgb_centres@coords[,1]
dgb_centres@coords[,2]
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
addMarkers(
lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
labelOptions = labelOptions(noHide = T, direction = "bottom",
style = list(
"color" = "red",
"font-family" = "serif",
"font-style" = "italic",
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "12px",
"border-color" = "rgba(0,0,0,0.5)"
))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 4px"),
textsize = "5px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
addMarkers(
lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
labelOptions = labelOptions(noHide = T, direction = "bottom",
style = list(
"color" = "red",
"font-family" = "serif",
"font-style" = "italic",
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "12px",
"border-color" = "rgba(0,0,0,0.5)"
))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
dhb.sdf$DHB2015_Na == "Area outside District Health Board"
dhb.sdf[dhb.sdf$DHB2015_Na == "Area outside District Health Board",]
dhb.sdf <- dhb.sdf[dhb.sdf$DHB2015_Na != "Area outside District Health Board",]
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = covid_dhb.df,
by = "DHB2015_Na")
dgb_centres <- gCentroid(dhb.sdf,byid = TRUE)
#dhb.sdf@data$Freq[is.na(dhb.sdf@data$Freq)] <- 0
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 4px"),
textsize = "5px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
addMarkers(
lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
labelOptions = labelOptions(noHide = T, direction = "bottom",
style = list(
"color" = "red",
"font-family" = "serif",
"font-style" = "italic",
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "12px",
"border-color" = "rgba(0,0,0,0.5)"
))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
#addControl(map_title, position = "topleft")
dhb.sdf <- dhb.sdf()
dhb.sdf <- dhb.sdf[dhb.sdf$DHB2015_Na != "Area outside District Health Board",]
virpal <- colorNumeric( palette = "viridis", domain = dhb.sdf@data$value, na.color = "transparent")
dhb.sdf@data <- left_join(x = dhb.sdf@data,
y = covid_dhb.df,
by = "DHB2015_Na")
dgb_centres <- gCentroid(dhb.sdf,byid = TRUE)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 4px"),
textsize = "5px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
addMarkers(
lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
labelOptions = labelOptions(noHide = T, direction = "bottom",
style = list(
"color" = "red",
"font-family" = "serif",
"font-style" = "italic",
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "12px",
"border-color" = "rgba(0,0,0,0.5)"
))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "2px 2px"),
textsize = "5px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") %>%
addMarkers(
lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
labelOptions = labelOptions(noHide = T, direction = "bottom",
style = list(
"color" = "red",
"font-family" = "serif",
"font-style" = "italic",
"box-shadow" = "3px 3px rgba(0,0,0,0.25)",
"font-size" = "6px",
"border-color" = "rgba(0,0,0,0.5)"
))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
runApp()
leaflet(data = dhb.sdf,
options = leafletOptions(minZoom = min_zoom, maxZoom = max_zoom,preferCanvas = T)) %>%
addPolygons(fillColor = ~virpal(dhb.sdf@data$value),
weight = 1,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlight = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE),
label = paste0(dhb.sdf$DHB2015_Na,":\n",dhb.sdf$value),
labelOptions = labelOptions(
style = list("font-weight" = "normal",
padding = "2px 2px"),
textsize = "5px",
direction = "auto")) %>%
addLegend(pal = virpal, values = ~dhb.sdf$value, opacity = 0.7, title = "COVID19 Cases by DHB",
position = "bottomright") #%>%
# addMarkers(
#     lng = dgb_centres@coords[,1], lat = dgb_centres@coords[,2],
#     label = paste(dhb.sdf$DHB2015_Na,": ",dhb.sdf$value),
#     labelOptions = labelOptions(noHide = T, direction = "bottom",
#                                 style = list(
#                                     "color" = "red",
#                                     "font-family" = "serif",
#                                     "font-style" = "italic",
#                                     "box-shadow" = "3px 3px rgba(0,0,0,0.25)",
#                                     "font-size" = "8px",
#                                     "border-color" = "rgba(0,0,0,0.5)"
#                                 ))) %>%
setView(lng = lng_init,
lat = lat_init,
zoom = zoom_level_init)
runApp()
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
runApp()
covid.df <- melt(covid.ls[[2]]) %>% filter(variable != "Total cases")
covid.ls <- read_html(url) %>% # "23_03_2020.html" # for static
html_table()
ggplot(data = covid.df) +
geom_col(mapping = aes(x = reorder(covid.df$DHB, -value),y = value,fill = variable)) +
labs(title = "NZ COVID19 cases - DHB",subtitle = paste(Sys.time(),Sys.timezone()),x = "Location",y = "Number of cases") +
theme_light() + theme(legend.position = "bottom") +
scale_fill_viridis(discrete = T) +
theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust  = 1,size = text_size))
ggplot(data = covid.df) +
geom_col(mapping = aes(x = reorder(covid.df$DHB, -value),y = value,fill = variable)) +
labs(title = "NZ COVID19 cases - DHB",subtitle = paste(Sys.time(),Sys.timezone()),x = "Location",y = "Number of cases") +
theme_light() + theme(legend.position = "bottom") +
scale_fill_viridis(discrete = T) +
theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust  = 1,size = text_size))
runApp()
runApp()
runApp()
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
runApp()
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
runApp()
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
shiny::runApp()
runApp()
runApp()
download.file(url = moh_map_url,
destfile = "www/moh_map.jpg")
download.file(url = moh_map_url,
destfile = "/www/moh_map.jpg")
download.file(url = moh_map_url,
destfile = "www/moh_map.jpg")
runApp()
rsconnect::setAccountInfo(name='mks29',
token='2B3E0D7FA92CCE82EBAB4891D4720E07',
secret='RZGWkhzCxgZX2K/Fy0nvor4Afuq2XHcWJd8++tsl')
rsconnect::deployApp(appName = "covid_nz",launch.browser = F)
runApp()
